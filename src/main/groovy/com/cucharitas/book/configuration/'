package com.cucharitas.book.configuration

import javax.jms.ConnectionFactory

import org.springframework.context.annotation.Configuration
import org.springframework.context.annotation.Import
import org.springframework.jms.annotation.EnableJms

@Configuration
@Import(AppConfiguration.class)
@EnableJms
@ComponentScan("com.cucharitas.book.configuration")
public class JmsConfiguration{
    private static final String BROKER_URL = "vm://embedded?broker.persistent=false,useShutdownHook=false"

    @Bean
    JmsListenerContainerFactory <?> jmsContainerFactory ( connectionFactory)
    {
        SimpleJmsListenerContainerFactory factory = new SimpleJmsListenerContainerFactory()
        factory.setConnectionFactory(connectionFactory())

        factory
    }

    @Bean
    ConnectionFactory connectionFactory(){
        new ActiveMQConnectionFactory(BROKER_URL)
    }

    @Bean
    BrokerService broker(){
        BrokerService broker = new BrokerService()
        broker.addConnector(BROKER_URL)
        broker.setDefaultDestination(queue())

}
